<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ Ø§Ù„Ø°ÙƒÙŠØ© - Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„</title>
    <!-- Tailwind + Fonts + Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap');
        
        * { 
            font-family: 'Cairo', sans-serif; 
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© */
        .gold-gradient { 
            background: linear-gradient(135deg, #eab308, #ca8a04);
            transition: all 0.3s;
        }
        
        .glass { 
            background: rgba(30, 41, 59, 0.8); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        
        .glass-light { 
            background: rgba(255,255,255,0.05); 
            backdrop-filter: blur(8px); 
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù†Ø§Øª */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .animate-slideIn {
            animation: slideIn 0.5s ease forwards;
        }

        .animate-pulse-slow {
            animation: pulse 2s infinite;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        /* ØªØ®ØµÙŠØµØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø© */
        #reader {
            width: 100%;
            height: auto;
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 3px solid #eab308;
        }

        /* Ø³ÙƒØ±ÙˆÙ„ Ù…Ø®ØµØµ */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #eab308;
            border-radius: 10px;
            transition: all 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ca8a04;
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª hover Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .hover-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hover-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(234, 179, 8, 0.2);
        }

        /* Ø²Ø± Ù…Ø®ØµØµ */
        .btn-glow {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .btn-glow::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-glow:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #eab308;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white">

    <!-- ==================== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ==================== -->
    <div id="loadingScreen" class="fixed inset-0 bg-slate-900 z-[100] flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold text-amber-400 animate-pulse">Ù…Ù†ØµØ© Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ Ø§Ù„Ø°ÙƒÙŠØ©</h2>
            <p class="text-gray-400 mt-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <!-- ==================== Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ ==================== -->
    <div id="toast" class="fixed top-4 right-4 z-[200] hidden">
        <div class="glass text-white px-6 py-3 rounded-2xl flex items-center gap-3 shadow-2xl border-r-4 border-amber-400">
            <i class="fas fa-check-circle text-amber-400 text-xl"></i>
            <span id="toastMessage">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</span>
        </div>
    </div>

    <!-- ==================== Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ==================== -->
    <div id="homePage" class="w-full max-w-4xl mx-auto p-4 min-h-screen flex items-center justify-center">
        <div class="text-center w-full animate-slideIn">
            <!-- Ø´Ø¹Ø§Ø± Ù…ØªØ­Ø±Ùƒ -->
            <div class="mb-8 animate-float">
                <div class="w-32 h-32 bg-amber-400 rounded-3xl mx-auto mb-4 flex items-center justify-center shadow-2xl">
                    <i class="fas fa-graduation-cap text-6xl text-slate-900"></i>
                </div>
                <h1 class="text-6xl font-black text-white mb-2">
                    Ù…Ù†ØµØ© <span class="text-amber-400">Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ</span>
                </h1>
                <p class="text-xl text-gray-400">Ù…Ø³ØªØ± Ù…Ø­Ù…Ø¯ Ø±Ø³ØªÙ…</p>
            </div>

            <!-- ÙƒØ§Ø±Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div class="max-w-md mx-auto glass p-8 rounded-3xl border border-amber-400/30">
                <div class="mb-6">
                    <label class="block text-right mb-2 text-gray-300">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <select id="userType" class="w-full p-4 rounded-xl bg-slate-800 border-2 border-amber-400/30 text-white focus:border-amber-400 transition">
                        <option value="teacher">ğŸ‘¨â€ğŸ« Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³</option>
                        <option value="student">ğŸ‘¨â€ğŸ“ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-right mb-2 text-gray-300">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                    <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" 
                           class="w-full p-4 rounded-xl bg-slate-800 border-2 border-amber-400/30 text-white focus:border-amber-400 transition">
                </div>
                <button onclick="login()" class="btn-glow w-full gold-gradient text-slate-900 font-black py-4 rounded-xl text-lg hover:scale-105 transition">
                    <i class="fas fa-sign-in-alt ml-2"></i>
                    Ø¯Ø®ÙˆÙ„
                </button>
            </div>

            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
            <div class="grid grid-cols-3 gap-4 mt-8">
                <div class="glass-light p-4 rounded-2xl">
                    <div class="text-2xl font-bold text-amber-400" id="homeStudentsCount">0</div>
                    <div class="text-sm text-gray-400">Ø·Ø§Ù„Ø¨</div>
                </div>
                <div class="glass-light p-4 rounded-2xl">
                    <div class="text-2xl font-bold text-blue-400" id="homeVideosCount">0</div>
                    <div class="text-sm text-gray-400">Ù…Ø­Ø§Ø¶Ø±Ø©</div>
                </div>
                <div class="glass-light p-4 rounded-2xl">
                    <div class="text-2xl font-bold text-green-400" id="homeAttendanceToday">0</div>
                    <div class="text-sm text-gray-400">Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ==================== -->
    <div id="teacherPanel" class="hidden w-full max-w-7xl mx-auto p-4">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="glass sticky top-0 z-40 p-6 mb-6 rounded-2xl border border-amber-400/30">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-amber-400 rounded-xl flex items-center justify-center">
                        <i class="fas fa-chalkboard-teacher text-2xl text-slate-900"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-black text-amber-400">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯Ø±Ø³</h2>
                        <p class="text-sm text-gray-400">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø³ØªØ± Ù…Ø­Ù…Ø¯</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="openCamera()" class="bg-green-600 text-white px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-green-700 transition">
                        <i class="fas fa-camera"></i>
                        ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø­Ø¶ÙˆØ±
                    </button>
                    <button onclick="exportData()" class="bg-blue-600 text-white px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-blue-700 transition">
                        <i class="fas fa-download"></i>
                        ØªØµØ¯ÙŠØ±
                    </button>
                    <button onclick="logout()" class="bg-red-500/20 text-red-500 px-6 py-3 rounded-xl hover:bg-red-500/30 transition">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
            <div class="glass p-4 rounded-xl hover-card">
                <i class="fas fa-users text-3xl text-amber-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                <p id="totalStudents" class="text-3xl font-black text-white">0</p>
            </div>
            <div class="glass p-4 rounded-xl hover-card">
                <i class="fas fa-video text-3xl text-blue-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</p>
                <p id="totalVideos" class="text-3xl font-black text-white">0</p>
            </div>
            <div class="glass p-4 rounded-xl hover-card">
                <i class="fas fa-eye text-3xl text-green-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</p>
                <p id="totalViews" class="text-3xl font-black text-white">0</p>
            </div>
            <div class="glass p-4 rounded-xl hover-card">
                <i class="fas fa-calendar-check text-3xl text-purple-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</p>
                <p id="todayAttendance" class="text-3xl font-black text-white">0</p>
            </div>
            <div class="glass p-4 rounded-xl hover-card">
                <i class="fas fa-percent text-3xl text-pink-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</p>
                <p id="attendancePercentage" class="text-3xl font-black text-white">0%</p>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ù…ØªØ·ÙˆØ±Ø© -->
        <div class="flex bg-slate-800 rounded-2xl overflow-hidden mb-6 border border-amber-400/30">
            <button onclick="showTeacherTab('students')" id="tabStudents" class="tab-btn active-tab flex-1 py-4 font-bold text-lg">
                <i class="fas fa-users ml-2"></i> Ø§Ù„Ø·Ù„Ø§Ø¨
            </button>
            <button onclick="showTeacherTab('videos')" id="tabVideos" class="tab-btn flex-1 py-4 font-bold text-lg">
                <i class="fas fa-video ml-2"></i> Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
            </button>
            <button onclick="showTeacherTab('attendance')" id="tabAttendance" class="tab-btn flex-1 py-4 font-bold text-lg">
                <i class="fas fa-calendar-alt ml-2"></i> Ø§Ù„Ø­Ø¶ÙˆØ±
            </button>
            <button onclick="showTeacherTab('stats')" id="tabStats" class="tab-btn flex-1 py-4 font-bold text-lg">
                <i class="fas fa-chart-bar ml-2"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            </button>
        </div>

        <!-- ========== Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØªØ·ÙˆØ± ========== -->
        <div id="studentsSection" class="tab-section">
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ -->
            <div class="glass p-6 rounded-2xl mb-6 border border-amber-400/30">
                <h3 class="font-bold mb-4 text-lg text-amber-400 flex items-center">
                    <i class="fas fa-user-plus ml-2"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="stdName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white focus:border-amber-400 transition">
                    <input type="text" id="stdCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white focus:border-amber-400 transition">
                    <input type="text" id="stdParent" placeholder="Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white focus:border-amber-400 transition">
                    <input type="text" id="stdCenter" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù†ØªØ±" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white focus:border-amber-400 transition">
                    <select id="stdYear" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                        <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option>
                        <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                    </select>
                    <input type="email" id="stdEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <input type="text" id="stdGroup" placeholder="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <button onclick="addStudent()" class="btn-glow bg-amber-500 text-slate-900 font-bold rounded-xl p-3 hover:bg-amber-400 transition">
                        <i class="fas fa-save ml-2"></i>
                        Ø­ÙØ¸
                    </button>
                </div>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ -->
            <div id="studentsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>

        <!-- ========== Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ± ========== -->
        <div id="videosSection" class="tab-section hidden">
            <div class="glass p-6 rounded-2xl mb-6 border border-blue-400/30">
                <h3 class="font-bold mb-4 text-lg text-blue-400 flex items-center">
                    <i class="fas fa-plus-circle ml-2"></i>
                    Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="videoTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <input type="text" id="videoUrl" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <input type="text" id="videoCenter" placeholder="Ø§Ù„Ø³Ù†ØªØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <select id="videoYear" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                        <option value="all">ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª</option>
                        <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option>
                        <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                    </select>
                    <input type="number" id="videoMaxViews" placeholder="Ø­Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª" value="10" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <input type="date" id="videoDate" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <input type="time" id="videoTime" class="p-3 rounded-xl bg-slate-700 border-2 border-slate-600 text-white">
                    <button onclick="addVideo()" class="btn-glow bg-blue-600 text-white font-bold rounded-xl p-3 hover:bg-blue-700 transition">
                        <i class="fas fa-upload ml-2"></i>
                        Ù†Ø´Ø±
                    </button>
                </div>
            </div>
            <div id="videosList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- ========== Ù‚Ø³Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ØªØ·ÙˆØ± ========== -->
        <div id="attendanceSection" class="tab-section hidden">
            <div class="glass p-6 rounded-2xl border border-green-400/30">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-lg text-green-400 flex items-center">
                        <i class="fas fa-calendar-check ml-2"></i>
                        Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±
                    </h3>
                    <div class="flex gap-3">
                        <input type="date" id="attendanceDate" class="p-3 rounded-xl bg-slate-700 border-2 border-green-400/30 text-white">
                        <button onclick="openCamera()" class="bg-green-600 text-white px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-green-700 transition">
                            <i class="fas fa-camera"></i>
                            Ù…Ø³Ø­ QR
                        </button>
                    </div>
                </div>
                <div id="attendanceList" class="space-y-3 max-h-96 overflow-y-auto custom-scroll"></div>
            </div>
        </div>

        <!-- ========== Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ========== -->
        <div id="statsSection" class="tab-section hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold mb-4 text-purple-400 flex items-center">
                        <i class="fas fa-chart-pie ml-2"></i>
                        ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨
                    </h3>
                    <div id="studentsChart" class="space-y-3">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </div>
                </div>

                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold mb-4 text-blue-400 flex items-center">
                        <i class="fas fa-chart-line ml-2"></i>
                        Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ø´Ø§Ù‡Ø¯Ø©
                    </h3>
                    <div id="topVideos" class="space-y-3"></div>
                </div>

                <!-- ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± -->
                <div class="glass p-6 rounded-2xl md:col-span-2">
                    <h3 class="font-bold mb-4 text-green-400 flex items-center">
                        <i class="fas fa-chart-bar ml-2"></i>
                        ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ
                    </h3>
                    <div id="weeklyReport" class="grid grid-cols-7 gap-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ==================== -->
    <div id="studentPanel" class="hidden w-full max-w-7xl mx-auto p-4">
        <!-- Ù‡ÙŠØ¯Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ -->
        <div class="glass sticky top-0 z-40 p-6 mb-6 rounded-2xl border border-blue-400/30">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-blue-400 rounded-xl flex items-center justify-center">
                        <i class="fas fa-user-graduate text-2xl text-slate-900"></i>
                    </div>
                    <div>
                        <h2 id="studentName" class="text-2xl font-black text-blue-400"></h2>
                        <p id="studentInfo" class="text-sm text-gray-400"></p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div id="studentQRCode" class="w-16 h-16 bg-white p-1 rounded-xl"></div>
                    <button onclick="logout()" class="bg-red-500/20 text-red-500 px-6 py-3 rounded-xl hover:bg-red-500/30 transition">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
        <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 rounded-xl">
                <i class="fas fa-eye text-2xl text-blue-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ù…Ø´Ø§Ù‡Ø¯Ø§ØªÙŠ</p>
                <p id="studentWatchedCount" class="text-2xl font-bold">0</p>
            </div>
            <div class="glass p-4 rounded-xl">
                <i class="fas fa-calendar-check text-2xl text-green-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ø­Ø¶ÙˆØ±ÙŠ</p>
                <p id="studentAttendanceCount" class="text-2xl font-bold">0</p>
            </div>
            <div class="glass p-4 rounded-xl">
                <i class="fas fa-percent text-2xl text-purple-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯Ù…</p>
                <p id="studentProgress" class="text-2xl font-bold">0%</p>
            </div>
            <div class="glass p-4 rounded-xl">
                <i class="fas fa-medal text-2xl text-amber-400 mb-2"></i>
                <p class="text-sm text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
                <p id="studentLevel" class="text-2xl font-bold">Ø¨Ø±ÙˆÙ†Ø²ÙŠ</p>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø·Ø§Ù„Ø¨ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª -->
            <div class="lg:col-span-2">
                <h3 class="font-bold text-xl text-blue-400 mb-4 flex items-center">
                    <i class="fas fa-video ml-2"></i>
                    Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
                </h3>
                <div id="studentVideosList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>

            <!-- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù† -->
            <div class="space-y-6">
                <!-- Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold text-lg text-green-400 mb-4 flex items-center">
                        <i class="fas fa-history ml-2"></i>
                        Ø¢Ø®Ø± 5 Ø­Ø¶ÙˆØ±
                    </h3>
                    <div id="studentAttendance" class="space-y-2"></div>
                </div>

                <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold text-lg text-amber-400 mb-4 flex items-center">
                        <i class="fas fa-bell ml-2"></i>
                        Ø¢Ø®Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    </h3>
                    <div id="studentNotifications" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== Ù†Ø§ÙØ°Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ==================== -->
    <div id="cameraModal" class="hidden fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl w-full max-w-2xl p-6 border border-green-400/30">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-green-400 flex items-center">
                    <i class="fas fa-camera ml-2"></i>
                    Ù…Ø³Ø­ QR ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨
                </h3>
                <button onclick="closeCamera()" class="text-white text-3xl hover:text-red-500 transition">&times;</button>
            </div>
            <div id="reader" class="w-full rounded-xl overflow-hidden bg-black"></div>
            <div id="scanResult" class="mt-4 p-4 rounded-xl text-center font-bold text-lg"></div>
            
            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø­ -->
            <div class="mt-4 flex justify-between text-sm text-gray-400">
                <span id="scanCounter">ØªÙ… Ù…Ø³Ø­ 0 Ø·Ø§Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…</span>
                <span id="scanTime">Ø¢Ø®Ø± Ù…Ø³Ø­: --:--</span>
            </div>
        </div>
    </div>

    <!-- ==================== Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ==================== -->
    <div id="videoModal" class="hidden fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl w-full max-w-5xl p-6 border border-blue-400/30">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-xl font-bold text-blue-400"></h3>
                <button onclick="closeModal()" class="text-white text-3xl hover:text-red-500 transition">&times;</button>
            </div>
            <div id="modalVideo" class="aspect-video bg-black rounded-xl shadow-2xl"></div>
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
            <div class="grid grid-cols-3 gap-4 mt-4">
                <div class="bg-slate-800 p-3 rounded-xl text-center">
                    <span class="text-sm text-gray-400">Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</span>
                    <p id="modalViews" class="text-xl font-bold text-blue-400"></p>
                </div>
                <div class="bg-slate-800 p-3 rounded-xl text-center">
                    <span class="text-sm text-gray-400">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</span>
                    <p id="modalRemaining" class="text-xl font-bold text-amber-400"></p>
                </div>
                <div class="bg-slate-800 p-3 rounded-xl text-center">
                    <span class="text-sm text-gray-400">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
                    <p class="text-xl font-bold text-green-400">
                        <i class="fas fa-star text-amber-400"></i> 4.5
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ====================
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let videos = JSON.parse(localStorage.getItem('videos')) || [];
        let attendance = JSON.parse(localStorage.getItem('attendance')) || {};
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        let currentUser = null;
        let html5QrCode = null;
        let scanCount = 0;

        // ==================== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ====================
        setTimeout(() => {
            document.getElementById('loadingScreen').style.display = 'none';
            updateHomeStats();
        }, 2000);

        // ==================== Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ====================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMessage');
            
            toastMsg.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // ==================== ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====================
        function updateHomeStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = attendance[today] ? Object.keys(attendance[today]).length : 0;
            
            document.getElementById('homeStudentsCount').textContent = students.length;
            document.getElementById('homeVideosCount').textContent = videos.length;
            document.getElementById('homeAttendanceToday').textContent = todayAttendance;
        }

        // ==================== Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ·ÙˆØ± ====================
        function login() {
            const type = document.getElementById('userType').value;
            const pass = document.getElementById('password').value;

            if(type === 'teacher' && pass === '1234') {
                document.getElementById('homePage').classList.add('hidden');
                document.getElementById('teacherPanel').classList.remove('hidden');
                updateTeacherUI();
                showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø³ØªØ± Ù…Ø­Ù…Ø¯', 'success');
                addNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³');
            } 
            else if(type === 'student') {
                const student = students.find(s => s.code === pass);
                if(student) {
                    currentUser = student;
                    document.getElementById('homePage').classList.add('hidden');
                    document.getElementById('studentPanel').classList.remove('hidden');
                    
                    document.getElementById('studentName').innerHTML = `Ø£Ù‡Ù„Ø§Ù‹ <span class="text-amber-400">${student.name}</span>`;
                    document.getElementById('studentInfo').innerHTML = `
                        <i class="fas fa-map-marker-alt ml-1"></i> ${student.center || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'} 
                        | Ø³Ù†Ø© ${student.year} 
                        | Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${student.group || 'A'}
                    `;
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ QR Code
                    document.getElementById('studentQRCode').innerHTML = '';
                    new QRCode(document.getElementById('studentQRCode'), {
                        text: String(student.code),
                        width: 60,
                        height: 60
                    });
                    
                    updateStudentUI();
                    showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${student.name}`, 'success');
                    addNotification(`Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ ${student.name}`);
                } else {
                    showToast('ÙƒÙˆØ¯ Ø·Ø§Ù„Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                }
            } else {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            }
        }

        function logout() {
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('teacherPanel').classList.add('hidden');
            document.getElementById('studentPanel').classList.add('hidden');
            
            if(html5QrCode) {
                html5QrCode.stop();
            }
            
            updateHomeStats();
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'info');
        }

        // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…ØªØ·ÙˆØ± ====================
        function openCamera() {
            document.getElementById('cameraModal').classList.remove('hidden');
            scanCount = 0;
            
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                onScanSuccess,
                onScanError
            ).catch(err => {
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§', 'error');
            });
        }

        function onScanSuccess(decodedText) {
            const student = students.find(s => s.code === decodedText);
            const date = document.getElementById('attendanceDate')?.value || new Date().toISOString().split('T')[0];
            
            if(student) {
                if(!attendance[date]) attendance[date] = {};
                
                if(!attendance[date][student.id]) {
                    attendance[date][student.id] = {
                        name: student.name,
                        time: new Date().toLocaleTimeString('ar-EG'),
                        method: 'QR',
                        center: student.center,
                        year: student.year
                    };
                    
                    localStorage.setItem('attendance', JSON.stringify(attendance));
                    scanCount++;
                    
                    document.getElementById('scanResult').innerHTML = `
                        <div class="text-green-400">
                            âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ${student.name}
                            <br>
                            <span class="text-sm">${new Date().toLocaleTimeString('ar-EG')}</span>
                        </div>
                    `;
                    
                    document.getElementById('scanCounter').innerHTML = `ØªÙ… Ù…Ø³Ø­ ${scanCount} Ø·Ø§Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…`;
                    document.getElementById('scanTime').innerHTML = `Ø¢Ø®Ø± Ù…Ø³Ø­: ${new Date().toLocaleTimeString('ar-EG')}`;
                    
                    updateAttendanceUI();
                    showToast(`ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ${student.name}`, 'success');
                    addNotification(`Ø­Ø¶ÙˆØ± ${student.name} Ø¹Ø¨Ø± QR`);
                } else {
                    document.getElementById('scanResult').innerHTML = `
                        <div class="text-amber-400">
                            âš ï¸ ${student.name} Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
                        </div>
                    `;
                }
            } else {
                document.getElementById('scanResult').innerHTML = `
                    <div class="text-red-400">
                        âŒ ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­
                    </div>
                `;
            }
        }

        function onScanError(error) {}

        function closeCamera() {
            if(html5QrCode) {
                html5QrCode.stop().then(() => {
                    document.getElementById('cameraModal').classList.add('hidden');
                });
            } else {
                document.getElementById('cameraModal').classList.add('hidden');
            }
        }

        // ==================== Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø± ====================
        function addNotification(message) {
            const notification = {
                id: Date.now(),
                message: message,
                time: new Date().toISOString(),
                read: false
            };
            notifications.unshift(notification);
            if(notifications.length > 50) notifications.pop();
            localStorage.setItem('notifications', JSON.stringify(notifications));
        }

        // ==================== ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ ====================
        function showTeacherTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab', 'bg-amber-500', 'text-slate-900'));
            document.querySelectorAll('.tab-section').forEach(s => s.classList.add('hidden'));
            
            if(tab === 'students') {
                document.getElementById('tabStudents').classList.add('active-tab', 'bg-amber-500', 'text-slate-900');
                document.getElementById('studentsSection').classList.remove('hidden');
            } else if(tab === 'videos') {
                document.getElementById('tabVideos').classList.add('active-tab', 'bg-amber-500', 'text-slate-900');
                document.getElementById('videosSection').classList.remove('hidden');
            } else if(tab === 'attendance') {
                document.getElementById('tabAttendance').classList.add('active-tab', 'bg-amber-500', 'text-slate-900');
                document.getElementById('attendanceSection').classList.remove('hidden');
                updateAttendanceUI();
            } else if(tab === 'stats') {
                document.getElementById('tabStats').classList.add('active-tab', 'bg-amber-500', 'text-slate-900');
                document.getElementById('statsSection').classList.remove('hidden');
                updateStatsUI();
            }
        }

        // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ====================
        function addStudent() {
            const student = {
                id: Date.now(),
                name: document.getElementById('stdName').value.trim(),
                code: document.getElementById('stdCode').value.trim(),
                parent: document.getElementById('stdParent').value.trim(),
                center: document.getElementById('stdCenter').value.trim(),
                year: document.getElementById('stdYear').value,
                email: document.getElementById('stdEmail')?.value.trim() || '',
                group: document.getElementById('stdGroup')?.value.trim() || 'A',
                createdAt: new Date().toISOString()
            };
            
            if(student.name && student.code) {
                students.push(student);
                localStorage.setItem('students', JSON.stringify(students));
                updateTeacherUI();
                clearStudentInputs();
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                addNotification(`Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: ${student.name}`);
            } else {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯', 'error');
            }
        }

        function deleteStudent(id) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
                const student = students.find(s => s.id === id);
                students = students.filter(s => s.id !== id);
                localStorage.setItem('students', JSON.stringify(students));
                updateTeacherUI();
                showToast(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ${student.name}`, 'info');
                addNotification(`Ø­Ø°Ù Ø·Ø§Ù„Ø¨: ${student.name}`);
            }
        }

        function updateTeacherUI() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const totalViews = videos.reduce((sum, v) => sum + (v.views || 0), 0);
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = attendance[today] ? Object.keys(attendance[today]).length : 0;
            const attendancePercent = students.length ? Math.round((todayAttendance / students.length) * 100) : 0;
            
            document.getElementById('totalStudents').innerText = students.length;
            document.getElementById('totalVideos').innerText = videos.length;
            document.getElementById('totalViews').innerText = totalViews;
            document.getElementById('todayAttendance').innerText = todayAttendance;
            document.getElementById('attendancePercentage').innerText = attendancePercent + '%';
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ø¹ QR
            document.getElementById('studentsList').innerHTML = students.map(s => {
                setTimeout(() => {
                    const qrDiv = document.getElementById(`qr-${s.id}`);
                    if(qrDiv) {
                        qrDiv.innerHTML = '';
                        new QRCode(qrDiv, {
                            text: String(s.code),
                            width: 100,
                            height: 100
                        });
                    }
                }, 100);
                
                return `
                    <div class="glass p-4 rounded-xl hover-card border border-amber-400/30">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-amber-400 text-lg">${s.name}</h4>
                                <p class="text-sm text-gray-400"><i class="fas fa-key ml-1"></i> ÙƒÙˆØ¯: ${s.code}</p>
                                <p class="text-sm"><i class="fas fa-phone ml-1 text-green-400"></i> ${s.parent || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                                <p class="text-sm"><i class="fas fa-map-marker-alt ml-1 text-blue-400"></i> ${s.center || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                                <p class="text-sm"><i class="fas fa-layer-group ml-1 text-purple-400"></i> Ø³Ù†Ø© ${s.year}</p>
                                <p class="text-sm"><i class="fas fa-users ml-1 text-amber-400"></i> Ù…Ø¬Ù…ÙˆØ¹Ø© ${s.group || 'A'}</p>
                            </div>
                            <div id="qr-${s.id}" class="bg-white p-1 rounded-lg"></div>
                        </div>
                        <div class="flex gap-2 mt-3">
                            <button onclick="deleteStudent(${s.id})" class="flex-1 bg-red-500/20 text-red-500 px-3 py-2 rounded-lg hover:bg-red-500/30 transition">
                                <i class="fas fa-trash ml-1"></i> Ø­Ø°Ù
                            </button>
                            <button onclick="viewStudentAttendance(${s.id})" class="flex-1 bg-blue-500/20 text-blue-400 px-3 py-2 rounded-lg hover:bg-blue-500/30 transition">
                                <i class="fas fa-calendar ml-1"></i> Ø­Ø¶ÙˆØ±
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ====================
        function addVideo() {
            const url = document.getElementById('videoUrl').value;
            let videoId = '';
            
            if(url.includes('v=')) videoId = url.split('v=')[1].split('&')[0];
            else if(url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1].split('?')[0];
            
            if(videoId) {
                const video = {
                    id: Date.now(),
                    title: document.getElementById('videoTitle').value,
                    videoId: videoId,
                    center: document.getElementById('videoCenter').value || 'all',
                    year: document.getElementById('videoYear').value,
                    maxViews: parseInt(document.getElementById('videoMaxViews').value) || 10,
                    views: 0,
                    date: document.getElementById('videoDate').value || new Date().toISOString().split('T')[0],
                    time: document.getElementById('videoTime').value || '20:00',
                    createdAt: new Date().toISOString()
                };
                
                videos.push(video);
                localStorage.setItem('videos', JSON.stringify(videos));
                updateTeacherUI();
                updateVideosList();
                
                document.getElementById('videoTitle').value = '';
                document.getElementById('videoUrl').value = '';
                document.getElementById('videoCenter').value = '';
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                addNotification(`Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø©: ${video.title}`);
            } else {
                showToast('Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
            }
        }

        function updateVideosList() {
            document.getElementById('videosList').innerHTML = videos.map(v => `
                <div class="glass p-4 rounded-xl hover-card border border-blue-400/30">
                    <img src="https://img.youtube.com/vi/${v.videoId}/mqdefault.jpg" 
                         class="w-full rounded-lg mb-3 cursor-pointer"
                         onclick="window.open('https://youtu.be/${v.videoId}')">
                    <h4 class="font-bold text-lg text-blue-400">${v.title}</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm mt-2">
                        <span><i class="fas fa-eye ml-1 text-green-400"></i> ${v.views || 0}/${v.maxViews}</span>
                        <span><i class="fas fa-calendar ml-1 text-amber-400"></i> ${v.date}</span>
                        <span><i class="fas fa-clock ml-1 text-blue-400"></i> ${v.time}</span>
                        <span><i class="fas fa-layer-group ml-1 text-purple-400"></i> Ø³Ù†Ø© ${v.year === 'all' ? 'Ø§Ù„ÙƒÙ„' : v.year}</span>
                    </div>
                    <button onclick="deleteVideo(${v.id})" class="mt-3 w-full bg-red-500/20 text-red-500 px-3 py-2 rounded-lg hover:bg-red-500/30 transition">
                        <i class="fas fa-trash ml-1"></i> Ø­Ø°Ù
                    </button>
                </div>
            `).join('');
        }

        function deleteVideo(id) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
                const video = videos.find(v => v.id === id);
                videos = videos.filter(v => v.id !== id);
                localStorage.setItem('videos', JSON.stringify(videos));
                updateTeacherUI();
                updateVideosList();
                showToast(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©`, 'info');
                addNotification(`Ø­Ø°Ù Ù…Ø­Ø§Ø¶Ø±Ø©: ${video.title}`);
            }
        }

        // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ØªØ·ÙˆØ± ====================
        function updateAttendanceUI() {
            const date = document.getElementById('attendanceDate').value || new Date().toISOString().split('T')[0];
            const todayAttendance = attendance[date] || {};
            
            document.getElementById('todayAttendance').innerText = Object.keys(todayAttendance).length;
            
            document.getElementById('attendanceList').innerHTML = students.map(s => {
                const isPresent = todayAttendance[s.id];
                return `
                    <div class="flex justify-between items-center p-4 bg-slate-800 rounded-xl hover:bg-slate-700 transition">
                        <div>
                            <span class="font-bold text-lg">${s.name}</span>
                            <span class="text-sm text-gray-400 mr-2">${s.center || ''} - Ù…Ø¬Ù…ÙˆØ¹Ø© ${s.group || 'A'}</span>
                            ${isPresent ? `
                                <div class="text-xs text-green-400 mt-1">
                                    <i class="fas fa-clock ml-1"></i> ${isPresent.time} 
                                    <span class="mr-2">ğŸ“± ${isPresent.method === 'QR' ? 'QR' : 'ÙŠØ¯ÙˆÙŠ'}</span>
                                </div>
                            ` : ''}
                        </div>
                        <button onclick="toggleAttendance('${date}', ${s.id})" 
                                class="px-4 py-2 rounded-lg text-sm font-bold transition ${isPresent ? 'bg-green-600 hover:bg-green-700' : 'bg-amber-600 hover:bg-amber-700'}">
                            ${isPresent ? 'âœ… Ø­Ø§Ø¶Ø±' : 'â­• ØªØ³Ø¬ÙŠÙ„'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        function toggleAttendance(date, studentId) {
            if(!attendance[date]) attendance[date] = {};
            
            if(attendance[date][studentId]) {
                delete attendance[date][studentId];
                showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¶ÙˆØ±', 'info');
            } else {
                const student = students.find(s => s.id === studentId);
                attendance[date][studentId] = {
                    name: student.name,
                    time: new Date().toLocaleTimeString('ar-EG'),
                    method: 'ÙŠØ¯ÙˆÙŠ',
                    center: student.center,
                    year: student.year
                };
                showToast(`ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ${student.name}`, 'success');
                addNotification(`Ø­Ø¶ÙˆØ± ${student.name} ÙŠØ¯ÙˆÙŠ`);
            }
            
            localStorage.setItem('attendance', JSON.stringify(attendance));
            updateAttendanceUI();
            updateTeacherUI();
        }

        // ==================== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ====================
        function updateStatsUI() {
            // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†ØªØ±
            const centers = {};
            students.forEach(s => {
                const center = s.center || 'Ø¨Ø¯ÙˆÙ† Ø³Ù†ØªØ±';
                centers[center] = (centers[center] || 0) + 1;
            });
            
            document.getElementById('studentsChart').innerHTML = Object.entries(centers).map(([center, count]) => `
                <div class="flex items-center gap-2">
                    <span class="w-24 text-sm">${center}</span>
                    <div class="flex-1 h-4 bg-slate-700 rounded-full overflow-hidden">
                        <div class="h-full bg-amber-400" style="width: ${(count/students.length*100)}%"></div>
                    </div>
                    <span class="text-sm font-bold">${count}</span>
                </div>
            `).join('');

            // Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ø´Ø§Ù‡Ø¯Ø©
            const topVideos = [...videos].sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 5);
            document.getElementById('topVideos').innerHTML = topVideos.map(v => `
                <div class="flex justify-between items-center">
                    <span class="text-sm">${v.title}</span>
                    <span class="text-sm font-bold text-blue-400">${v.views || 0} ğŸ‘</span>
                </div>
            `).join('');

            // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const weeklyReport = document.getElementById('weeklyReport');
            weeklyReport.innerHTML = '';
            
            for(let i = 0; i < 7; i++) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                const count = attendance[dateStr] ? Object.keys(attendance[dateStr]).length : 0;
                
                weeklyReport.innerHTML += `
                    <div class="text-center">
                        <div class="text-xs text-gray-400">${days[d.getDay()]}</div>
                        <div class="mt-1 h-20 bg-slate-700 rounded-lg relative overflow-hidden">
                            <div class="absolute bottom-0 w-full bg-green-400" style="height: ${students.length ? (count/students.length*100) : 0}%"></div>
                        </div>
                        <div class="text-xs mt-1 font-bold">${count}</div>
                    </div>
                `;
            }
        }

        // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ====================
        function updateStudentUI() {
            if(!currentUser) return;
            
            // Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©
            const studentVideos = videos.filter(v => 
                (v.year === 'all' || v.year == currentUser.year) && 
                (v.center === 'all' || v.center === currentUser.center)
            );
            
            document.getElementById('studentVideosList').innerHTML = studentVideos.map(v => {
                const canWatch = (v.views || 0) < v.maxViews;
                return `
                    <div class="glass p-4 rounded-xl hover-card ${!canWatch ? 'opacity-60' : ''}">
                        <img src="https://img.youtube.com/vi/${v.videoId}/mqdefault.jpg" 
                             class="w-full rounded-lg mb-3 cursor-pointer"
                             onclick="${canWatch ? `watchVideo('${v.videoId}', '${v.title}', ${v.views || 0}, ${v.maxViews})` : 'showToast(\'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª\', \'error\')'}">
                        <h4 class="font-bold text-blue-400">${v.title}</h4>
                        <div class="flex justify-between items-center mt-2 text-sm">
                            <span><i class="fas fa-eye ml-1 text-green-400"></i> ${v.views || 0}/${v.maxViews}</span>
                            <span class="${canWatch ? 'text-green-400' : 'text-red-400'}">
                                ${canWatch ? 'Ù…ØªØ§Ø­' : 'Ù…Ù†ØªÙ‡ÙŠ'}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');

            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
            const watchedCount = videos.reduce((sum, v) => sum + (v.views || 0), 0);
            const attendanceCount = Object.keys(attendance).filter(date => attendance[date][currentUser.id]).length;
            const progress = videos.length ? Math.round((watchedCount / videos.length) * 100) : 0;
            
            document.getElementById('studentWatchedCount').innerText = watchedCount;
            document.getElementById('studentAttendanceCount').innerText = attendanceCount;
            document.getElementById('studentProgress').innerText = progress + '%';
            document.getElementById('studentLevel').innerText = progress >= 80 ? 'Ø°Ù‡Ø¨ÙŠ ğŸ†' : progress >= 50 ? 'ÙØ¶ÙŠ ğŸ¥ˆ' : 'Ø¨Ø±ÙˆÙ†Ø²ÙŠ ğŸ¥‰';

            // Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±
            const studentAttendance = [];
            Object.keys(attendance).sort().reverse().slice(0, 5).forEach(date => {
                if(attendance[date][currentUser.id]) {
                    studentAttendance.push(`
                        <div class="flex justify-between p-3 bg-slate-800 rounded-lg">
                            <span class="text-sm">ğŸ“… ${date}</span>
                            <span class="text-sm text-green-400">âœ… ${attendance[date][currentUser.id].time}</span>
                        </div>
                    `);
                }
            });
            
            document.getElementById('studentAttendance').innerHTML = studentAttendance.join('') || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ±';

            // Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            const studentNotifications = notifications.filter(n => n.message.includes(currentUser.name)).slice(0, 5);
            document.getElementById('studentNotifications').innerHTML = studentNotifications.map(n => `
                <div class="p-3 bg-slate-800 rounded-lg text-sm">
                    ${n.message}
                    <span class="block text-xs text-gray-400 mt-1">${new Date(n.time).toLocaleString('ar-EG')}</span>
                </div>
            `).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
        }

        // ==================== Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ====================
        function watchVideo(videoId, title, currentViews, maxViews) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalVideo').innerHTML = `
                <iframe class="w-full h-full rounded-lg" src="https://www.youtube.com/embed/${videoId}?autoplay=1" frameborder="0" allowfullscreen></iframe>
            `;
            document.getElementById('modalViews').innerHTML = `${currentViews + 1}/${maxViews} <i class="fas fa-eye ml-1"></i>`;
            document.getElementById('modalRemaining').innerHTML = `${maxViews - (currentViews + 1)} <i class="fas fa-hourglass-half ml-1"></i>`;
            document.getElementById('videoModal').classList.remove('hidden');

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
            const video = videos.find(v => v.videoId === videoId);
            if(video) {
                video.views = (video.views || 0) + 1;
                localStorage.setItem('videos', JSON.stringify(videos));
                addNotification(`Ù…Ø´Ø§Ù‡Ø¯Ø© ${currentUser?.name || 'Ù…Ø³ØªØ®Ø¯Ù…'} Ù„Ù€ ${title}`);
            }
        }

        function closeModal() {
            document.getElementById('videoModal').classList.add('hidden');
            document.getElementById('modalVideo').innerHTML = '';
        }

        // ==================== ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====================
        function exportData() {
            const data = {
                students: students,
                videos: videos,
                attendance: attendance,
                notifications: notifications,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `platform-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
        function clearStudentInputs() {
            document.getElementById('stdName').value = '';
            document.getElementById('stdCode').value = '';
            document.getElementById('stdParent').value = '';
            document.getElementById('stdCenter').value = '';
        }

        function viewStudentAttendance(studentId) {
            showTeacherTab('attendance');
            showToast('Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ø§Ù„Ø¨', 'info');
        }

        // ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® ====================
        document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø¹Ø±Ø¶
        updateHomeStats();
    </script>

    <style>
        .active-tab { 
            background: #eab308; 
            color: #0f172a; 
            font-weight: 900; 
        }
        .tab-btn { 
            transition: all 0.3s; 
            cursor: pointer; 
            position: relative;
            overflow: hidden;
        }
        .tab-btn:hover { 
            background: rgba(234, 179, 8, 0.2); 
        }
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #eab308;
            border-radius: 3px;
        }
        .hover-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .hover-card:hover {
            transform: translateY(-5px) scale(1.02);
        }
    </style>
</body>
</html>
